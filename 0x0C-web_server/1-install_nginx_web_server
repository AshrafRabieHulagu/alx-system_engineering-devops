#!/bin/bash

# Update package index
apt-get update -y

# Install nginx
apt-get install nginx -y

# Create a default index.html file with "Hello World!" content
echo "Hello World!" > /var/www/html/index.html

# Check if nginx is running and restart if necessary
if pgrep "nginx" >/dev/null; then
    killall nginx
fi

# Start nginx
nginx

# Verify nginx is listening on port 80
netstat -tnl | grep ':80' > /dev/null
if [ $? -eq 0 ]; then
    echo "Nginx is listening on port 80."
else
    echo "Nginx is not listening on port 80."
    exit 1
fi

# Verify the nginx root URL returns "Hello World!"
response=$(curl -s http://localhost)
if [[ "$response" == "Hello World!" ]]; then
    echo "Nginx root URL returns 'Hello World!'."
else
    echo "Nginx root URL does not return 'Hello World!'."
    exit 1
fi
